function spi = gsw_pspi(SA,CT,pr)
% Potential spicity based on TEOS_10
% SA: Absolute salinity, in the range of [10:40] (g/kg).
% CT: Conservative temperature, in the range of [-2:40] (^oC)
% pr: Reference pressure (db), must be one of the following intergers:
%        0, 500, 1000, 2000, 3000, 4000, 5000 (db)
% Example: gsw_pspi(37.0,15.000,0)=1.3010 (kg/m^3);
% Author: Rui Xin Huang
% Date: Sep. 28, 2018
 
b0=[ -0.0171500663640825,  0.0278126882615466, -0.0377076764387318,...
      0.1766949182578261,  0.0123660614159258, -0.0786187616470358,...
      0.5654881379784148,  0.0819229370724436,  0.0016117501650810,...
      0.3399789798792979,  1.1510501460340983,  0.2269712954132772,...
      0.0034027893357210, -0.0006433028065820, -2.4325213233770255,...
      1.7986328638555464,  1.0630530543043479,  0.1315650249668150,...
      0.0123872288821259, -0.0001162370520279,  9.4412720110135577,...
      5.2288742719111454, -2.0527960573002453, -0.5351256154930265,...
     -0.2538791804144606, -0.0209657872828231,  0.0013762624523221,...
    -20.8951737319684660,-12.0500968552060320, 11.3282734921878920,...
      2.6701702134225695,  0.5047618576788786,  0.4114298464948320,...
      0.0054621969229276, -0.0011544718126917, 27.9102532787346750,...
     38.3524589057019940,-15.7880978505589340, -5.2014100596868458,...
     -1.6444622029678000, -0.1940601182950926, -0.4451390714439674,...
      0.0318285987830426,  0.0002610786604573,-19.9067865528804480,...
    -40.9762890937185630, 14.0378531543133480,  7.5013409290727173,...
      0.6852984398082621,  1.0864034614467579, -0.1443123955763263,...
      0.3116506259221469, -0.0374707683235198,  0.0003602355280168,...
      6.4526166843817130, 23.5603943927535690, -0.1544936317675803,...
     -2.0654213392823562, -2.3484390479461044,  1.2077832413374705,...
     -0.7375977238163819,  0.2037145511491106, -0.1037032514606002,...
      0.0135916525382002, -0.0002031986199229];
b500=[-0.0182391987673546,  0.0460367847358395, -0.0286182192704045,...
       0.2660847104116245,  0.0206673399387414, -0.0298007013259687,...
       0.7770094369066807,  0.1251051429700339,  0.0028476405867851,...
       0.2732186418523409,  1.4034080039262458,  0.3119256718363070,...
       0.0090495634322624, -0.0019995910040957, -1.4285067908881954,...
       2.4382974814612299,  1.3470633754508330,  0.2346478272358809,...
      -0.0024859020619016,  0.0035261905625462,  6.0718169574685028,...
       3.2771054529421333, -2.1234813624271149, -0.8676978602413056,...
      -0.4525801376304305,  0.0302373171446931, -0.0066258727117268,...
     -13.0149881442439100, -4.8980524182905798, 11.2404267704152550,...
       3.6705166907148050,  0.9927811680516538,  0.6597340841418953,...
      -0.0890970730587889,  0.0113440640814710, 17.6138287954952340,...
      23.1042897942189110,-14.0150247189858150, -6.7035271369546621,...
      -2.3493946449434784, -0.6652221178039853, -0.6098849102442132,...
       0.1310559376769550, -0.0113401749308976,-12.4704499840356750,...
     -24.6120143973906740, 11.7844367965431600,  8.6220035582779673,...
       1.5600677522586048,  1.2667953809112951,  0.1662333591001361,...
       0.3575983205997738, -0.0906989152954278,  0.0062620914224265,...
       4.1599595530865345, 15.0628535938609790,  0.2359014673160792,...
      -2.5129596228128590, -2.3628293562073948,  0.7771260421750895,...
      -0.6377943796237359,  0.0934531200410584, -0.1017862844693545,...
       0.0249840213426481, -0.0014670482649370];
b1000=[-0.0150169592493302,  0.0713618996357972, -0.0063107595207969,...
        0.3769874692789238,  0.0323471419293896,  0.0351208366975207,...
        1.0068345758287314,  0.1795605422124667,  0.0046453697978788,...
        0.2660759416082976,  1.6500909237389616,  0.4159308583779059,...
        0.0172494972199483, -0.0037161650590758, -0.7389047240972881,...
        2.8726693927520741,  1.6113998813159669,  0.3263230715734760,...
       -0.0159057725287228,  0.0074942309647332,  3.9264795079017127,...
        2.0179651645749908, -2.1175594837314753, -1.1469107615651093,...
       -0.6074186313683612,  0.0677203517868007, -0.0143769224106303,...
       -8.0548342124827972, -0.5928438573972383, 11.0255586363736220,...
        4.4397150056556818,  1.4442136322713750,  0.8260715519198784,...
       -0.1506947213105953,  0.0229660159301995, 11.1990826198239940,...
       13.6095051050301340,-12.6310176774328490, -7.6517232263421988,...
       -2.9693324389401625, -1.1000629722739033, -0.6881119910562087,...
        0.1921672059589442, -0.0217714705421179, -7.8758049022617191,...
      -14.6605730305262480, 10.1796178565571620,  9.1511612055300944,...
        2.2872279620162583,  1.4537424541706934,  0.4416488901443254,...
        0.3576765139643476, -0.1214552440110710,  0.0114134836142687,...
        2.7139348361455027,  9.7516625559981929,  0.2987095744451148,...
       -2.6146201473329445, -2.4315227608803371,  0.4492468555801895,...
       -0.5825975638039069,  0.0024091152481619, -0.0908793614566750,...
        0.0310251270439888, -0.0025415628426548];
b2000=[0.0118725171307861,  0.1477131706258137,  0.0834813257093114,...
       0.6599137014434021,  0.0680516618086130,  0.2056975644582296,...
       1.4918339417551207,  0.3232891612201607,  0.0113336667540298,...
       0.3424735985442436,  2.0769105873867950,  0.6621541396169911,...
       0.0398475935424811, -0.0120326243958032,  0.0839673587433891,...
       3.3309734341621686,  2.0729677748383186,  0.5059266326029840,...
      -0.0325258166488220,  0.0265644919076263,  1.6014497732194890,...
       0.6161666794487847, -1.9913875207602947, -1.5500876845238303,...
      -0.8799191720117091,  0.1015518689370360, -0.0470216853054528,...
      -2.7994257154120965,  3.5159322977333956, 10.2656078026672490,...
       5.4476192811129387,  2.1734084242037079,  1.1079785499395909,...
      -0.1965732708177111,  0.0648844582071067,  4.4478571483231457,...
       3.6641414589882118,-10.5199114511468410, -8.4064292803243426,...
      -3.9437412282869984, -1.7784906820961639, -0.8161104954398789,...
       0.2394122578444220, -0.0552579182468893, -3.1069204661153766,...
      -4.5506367620167794,  7.9828080917585664,  9.1038181215613800,...
       3.3383303511897680,  1.7990562949251985,  0.8465619225558672,...
       0.3623224164714963, -0.1449773658955066,  0.0264933443506279,...
       1.1677288756026567,  4.0963629227533662,  0.0301263628948869,...
      -2.3477813538639669, -2.5251926836364276, -0.0310694147451350,...
      -0.5409428343692908, -0.1237935747915165, -0.0769972427989191,...
       0.0352324267135054, -0.0054667842148308];
b3000=[0.0785827635885904,  0.2695551278473896,  0.2382238071652584,...
       1.0328216533370393,  0.1247478915007856,  0.4140162390210347,...
       2.0015284460583023,  0.5108760266785902,  0.0229668651712469,...
       0.4710255345980255,  2.4507597986923821,  0.9595824732835634,...
       0.0912687197370605, -0.0240034498070701,  0.4836291827068407,...
       3.3828221467655655,  2.3058697460666830,  0.6188641682998639,...
      -0.0949060571716785,  0.0495255939652645,  0.5631345594473561,...
       0.2193349421518067, -1.4348177523796932, -1.5055199075437735,...
      -0.9999286994881966,  0.1998449905375284, -0.0808028164411438,...
      -0.5060056249998237,  4.4743121103908896,  8.3948864853180467,...
       5.2860988199539962,  2.3163728323890709,  1.2237869330729148,...
      -0.2969414302782713,  0.1071995711552660,  1.4357200837713233,...
      -0.4131525876537621, -8.0340818810588601, -7.4140709614476386,...
      -4.0771581274065571, -1.9635295248168707, -0.8577369546298485,...
       0.3186249517210864, -0.0891383917028742, -1.0078183826520721,...
      -0.3538133913055781,  5.9431525757315100,  7.5824825760773091,...
       3.5194822652513134,  1.8658194832864889,  0.9880724039275926,...
       0.3608443033516683, -0.1807834054140192,  0.0418809878176974,...
       0.4487343447885416,  1.4512313465086606, -0.3360118727756923,...
      -1.7510557364241466, -2.2962938198371936, -0.3088419704935886,...
      -0.5015613420413067, -0.1810832842851992, -0.0717364475787328,...
       0.0418213839282947,  -0.0084933148202667];
b4000=[0.2025292728310694,  0.4535805178193371,  0.4619529228253870,...
       1.5050223213845073,  0.2071955505767959,  0.6437308550992064,...
       2.5243360744326573,  0.7412658851522664,  0.0423704843675533,...
       0.6140978851799495,  2.7862073290509763,  1.2998138955622245,...
       0.1641947081515549, -0.0449927428457055,  0.6279650013273181,...
       3.1207312076604552,  2.2407723123627745,  0.5974101842363415,...
      -0.1825641579944942,  0.0855909178828273,  0.1844413155784955,...
       0.5223664533265552, -0.3519721696481735, -0.9008619702435032,...
      -0.8448635820898949,  0.3092224003983553, -0.1257086609252269,...
       0.3384673101491614,  3.6348681214896899,  5.3562413927987294,...
       3.6504512985769546,  1.6480236985680801,  1.0007490307016402,...
      -0.3649451095039235,  0.1574038007122379,  0.1857481467182152,...
      -1.4220805549487217, -4.8292551318561738, -4.6970627283560491,...
      -2.9443647298503630, -1.5212482732609338, -0.6594809864833450,...
       0.3448536440626046, -0.1264469788813310, -0.1324725541385111,...
       0.9869763458864849,  3.6542601906524093,  4.8370370795241673,...
       2.5399592178743542,  1.4048963955470359,  0.8468579636180608,...
       0.2684141147143119, -0.1833004462925690,  0.0578087199931896,...
       0.1173135531934554,  0.2527217950051099, -0.5079195041748702,...
      -1.0466273387162957, -1.6395178196376621, -0.3381652791256403,...
      -0.3871687754769886, -0.1831466213460729, -0.0535170370052017,...
       0.0403261430308532, -0.0114729554142256];
b5000=[0.3820086307374105,  0.6807613639619611,  0.7180920672500770,...
       1.9793843471466850,  0.3124949454944219,  0.8433489272703364,...
       2.9250611189905955,  1.0042895177915170,  0.0642414761968527,...
       0.7221376372236928,  2.9668170274813592,  1.6548086286881780,...
       0.2275290990451938, -0.0590145072807306,  0.6090090598891532,...
       2.7374627218706937,  2.0801130054946806,  0.4628016849985791,...
      -0.2343271318404560,  0.0994940210577284,  0.1681432252906211,...
       0.8912020824082482,  0.5479975819471963, -0.1748191031230424,...
      -0.4657776175011719,  0.3404629504354561, -0.1222687660231525,...
       0.3675000299589536,  2.3164749832104210,  2.9563110112297850,...
       1.8627674152533542,  0.6905272676347027,  0.4954414141356421,...
      -0.3089017239367066,  0.1466725239452260, -0.0469903429666572,...
      -0.9965580503457868, -2.5914028295128619, -2.3810575257098692,...
      -1.4495868944669281, -0.8176403208799353, -0.2511400103769822,...
       0.2533189951137676, -0.1161276788157323,  0.0374559531927267,...
       0.7971207608475803,  2.0059253087100357,  2.7952067050958371,...
       1.4339645049242822,  0.7106855454689587,  0.5809337260602813,...
       0.0865651273628418, -0.1249025137207347,  0.0525079242576474,...
       0.0251227182549338, -0.0232741163472784, -0.3864171843725351,...
      -0.6045662972801092, -1.0425898811276679, -0.2605925512215324,...
      -0.2288471328224155, -0.1616192788490930, -0.0193525655071953,...
       0.0253750796226042,  -0.0103837266541834];
 
IC=0;
if (pr==0),        b=b0;       spi0=3.494486289; IC=1; end
if (pr== 500),   b=b500;   spi0=1.720013647; IC=1; end
if (pr==1000),  b=b1000; spi0=1.362343815; IC=1; end
if (pr==2000),  b=b2000; spi0=1.451450857; IC=1; end
if (pr==3000),  b=b3000; spi0=1.765290149; IC=1; end
if (pr==4000),  b=b4000; spi0=2.180009299; IC=1; end
if (pr==5000),  b=b5000; spi0=2.628557566; IC=1; end
if (IC==0), error('Reference pressure incorrect '), end
 
if (SA<10 | SA>40), error('Salinity out of bound'), end
if (CT<-2 | CT>40), error('Temperature out of bound'), end
 
s=(SA-10)/30;
t=(CT+2)/42;
  s2=s.*s;s3=s2.*s;s4=s3.*s;s5=s4.*s;s6=s5.*s;s7=s6.*s;s8=s7.*s;s9=s8.*s;s10=s9.*s;
  t2=t.*t;t3=t2.*t;t4=t3.*t;t5=t4.*t;t6=t5.*t;t7=t6.*t;t8=t7.*t;t9=t8.*t;t10=t9.*t;
sp=b(1).*s+b(2).*t+b(3).*s2+b(4).*s.*t+b(5).*t2;
sp=sp+b(6).*s3+b(7).*s2.*t+b(8).*s.*t2+b(9).*t3;
sp=sp+b(10).*s4+b(11).*s3.*t+b(12).*s2.*t2+b(13).*s.*t3+b(14).*t4;
sp=sp+b(15).*s5+b(16).*s4.*t+b(17).*s3.*t2+b(18).*s2.*t3+b(19).*s.*t4+b(20).*t5;
sp=sp+b(21).*s6+b(22).*s5.*t+b(23).*s4.*t2+...
    b(24).*s3.*t3+b(25).*s2.*t4+b(26).*s.*t5+b(27).*t6;
sp=sp+b(28).*s7+b(29).*s6.*t+b(30).*s5.*t2+...
    b(31).*s4.*t3+b(32).*s3.*t4+b(33).*s2.*t5+b(34).*s.*t6+b(35).*t7;
sp=sp+b(36).*s8+b(37).*s7.*t+b(38).*s6.*t2+...
    b(39).*s5.*t3+b(40).*s4.*t4+b(41).*s3.*t5+b(42).*s2.*t6+b(43).*s.*t7+b(44).*t8;
sp=sp+b(45).*s9+b(46).*s8.*t+b(47).*s7.*t2+b(48).*s6.*t3+b(49).*s5.*t4+...
    b(50).*s4.*t5+b(51).*s3.*t6+b(52).*s2.*t7+b(53).*s.*t8+b(54).*t9;
sp=sp+b(55).*s10+b(56).*s9.*t+b(57).*s8.*t2+b(58).*s7.*t3+b(59).*s6.*t4+...
    b(60).*s5.*t5+b(61).*s4.*t6+b(62).*s3.*t7+b(63).*s2.*t8+b(64).*s.*t9+b(65).*t10;
spi = sp-spi0;
return


